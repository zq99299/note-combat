(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{388:function(s,a,t){"use strict";t.r(a);var n=t(13),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ci-cd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd"}},[s._v("#")]),s._v(" CI/CD")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/README.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("基本概念之类的这里不再赘述，要使用 CI/CD 的前提是需要安装 GitLab Runner 并注册到你的 GitLab 服务器上，所有的 CI/CD 就是在该 Runner 上进行处理交互")]),s._v(" "),t("p",[s._v("对于 GitLab Runner 安装笔者这里没有机会实践，也不进行，使用已经安装好的单机 docker 环境来自动化打包 boot 程序为 docker 镜像")]),s._v(" "),t("p",[s._v("至于初体验，官网 "),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/quick_start/#create-a-gitlab-ciyml-file",target:"_blank",rel:"noopener noreferrer"}},[s._v("开始"),t("OutboundLink")],1),s._v(" 里已经给出了例子，全部是使用 echo 命令输出，定义了几个 job 作业，可以自己去实验下")]),s._v(" "),t("p",[s._v("学习路径：")]),s._v(" "),t("ol",[t("li",[s._v("先把环境搭建起来， gitlab 服务器、gitlab runner 注册上")]),s._v(" "),t("li",[s._v("CI/DI 官方文档中的开始、流水线、job 等概念先读一遍")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html",target:"_blank",rel:"noopener noreferrer"}},[s._v(".gitlab-ci.yml 章节"),t("OutboundLink")],1),s._v("，可以参考这里的内容完成自己的 yml 编写")])]),s._v(" "),t("h2",{attrs:{id:"打包-bootjar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包-bootjar"}},[s._v("#")]),s._v(" 打包 bootJar")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认设置，所有作业都默认使用这里的配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" package  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示使用哪一个 runner 来运行")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 定义阶段执行顺序")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官网文档：https://docs.gitlab.com/ee/ci/yaml/README.html#stage")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 含义：一个阶段的所有作业必须在下一个阶段执行之前完成")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的阶段有：.pre、build、test、deploy、.post 其中 .pre 和 .post 永远是在最开始和最后执行（其他的可以被自定义的顺序控制），而不管在这里定义的顺序是什么")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可自定义阶段，按照你要让他们运行的顺序进行排序，同一阶段可以并行运行（前提是配置了并行数量）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 这里自定义了执行顺序")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dockerBuild  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增了一个自定义的 dockerBuild 阶段")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 定义作业名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-bootJar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义阶段，用于执行顺序的控制")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用镜像运行，选择有 gradle 的镜像")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker.xxx.com/gradle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("6.7.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk8\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义执行脚本")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /builds/data/project-citest/.gradle")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "exec bootJar'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' gradle：`pwd`/.gradle"\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" export GRADLE_USER_HOME=`pwd`/.gradle\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 gradle 的时候打印 info 日志信息，可以看到下载依赖的请求")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" gradle bootJar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("info\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("l $GRADLE_USER_HOME;\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("l build/libs/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("这样就定义了一个执行 gradle 执行 bootJar 生成 boot jar 包的作业。")]),s._v(" "),t("p",[s._v("这里在执行的时候，你会发现每次构建都很耗时（通过 "),t("code",[s._v("gradle bootJar --info")]),s._v(" ），通过 "),t("code",[s._v("--info")]),s._v(" 看到控制台上输出的日志信息，大部分耗时都在重新下载 jar 包依赖了，我们考虑使用缓存来缓存这些内容")]),s._v(" "),t("h2",{attrs:{id:"缓存-gradle-的-jar-包依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存-gradle-的-jar-包依赖"}},[s._v("#")]),s._v(" 缓存 gradle 的 jar 包依赖")]),s._v(" "),t("p",[s._v("给作业增加了 cache 配置")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 定义作业名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-bootJar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义阶段，用于执行顺序的控制")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用镜像运行，选择有 gradle 的镜像")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xxx/gradle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("6.7.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk8\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义执行脚本")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /builds/data/project-citest/.gradle")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "exec bootJar'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' gradle：`pwd`/.gradle"\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" export GRADLE_USER_HOME=`pwd`/.gradle\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 gradle 的时候打印 info 日志信息，可以看到下载依赖的请求")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" gradle bootJar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("info\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("l $GRADLE_USER_HOME;\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("l build/libs/\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 缓存")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存依赖原理和最佳实践：https://docs.gitlab.com/ee/ci/yaml/README.html#cache")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存语法：https://docs.gitlab.com/ee/ci/yaml/README.html#cache")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用预定义变量，项目名称 作为缓存的 key，目的是为了该项目的所有分支都使用该缓存")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 所有预定义变量")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方文档：https://docs.gitlab.com/ee/ci/variables/predefined_variables.html")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方支持的变量，可以直接使用，而不用定义的变量")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CI_PROJECT_NAME"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 要缓存的内容有哪些？")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在上面定义了  GRADLE_USER_HOME ，那么 gradle 的相关工作目录则就在该目录下，使用了 pwd，则是当前的项目目录下，所以这里使用相对路径就能获取到")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# image 使用的是 gradle:6.7.1-jdk8，意思是该镜像已经安装了 gradle 6.7.1，")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果要使用项目相同的 wrapper 里面的版本，则需要缓存该目录，不用每次都下载 gradle 了，但是所有使用 gradle 的地方需要改成 gradlew")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .gradle/wrapper\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gradle 的 jar 包依赖全部下载到这个地方")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .gradle/caches\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 缓存策略")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认是 pull-push，执行作业前，先下载缓存文件到指定目录，作业完成后，再上传")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("policy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("push\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("查看缓存是否成功，可以看 ci 控制台输出的内容")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在作业执行前显示了一条 Restoring cache")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个就是在还原缓存，没有其他信息，因为我们是第一次执行")]),s._v("\nRestoring cache\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里是上面 script 中执行的内容，目的是为了看看 gradle 工作目录下有哪些文件")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GRADLE_USER_HOME")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:35 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.7")]),s._v(".1\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:34 buildOutputCleanup\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:29 caches\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个是 jar 包依赖文件目录")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:30 checksums\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:35 configuration-cache\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:29 daemon\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:34 jdks\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:29 native\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:29 notifications\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:35 vcs-1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bootJar 也出来了")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l build/libs/\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16648")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17047394")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 06:35 citest-0.0.1-SNAPSHOT.jar\nSaving cache "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" successful job\n00:02\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面是开始创建缓存了")]),s._v("\nCreating cache project-citest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .gradle/wrapper 没有匹配到文件，这个是我们没有使用 gradlew 命令，是正常的")]),s._v("\nWARNING: .gradle/wrapper: no matching files    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里找到了 1086 个文件或则目录，说明缓存生效了")]),s._v("\n.gradle/caches: found "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1086")]),s._v(" matching files and directories \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有提供 URL，缓存将不会上传到共享缓存服务器。缓存将只存储在本地。")]),s._v("\nNo URL provided, cache will be not uploaded to shared cache server. Cache will be stored only locally. \nCreated cache\nCleaning up "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" based variables\n00:01\nJob succeeded\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("p",[s._v("下面再次修改文件，上传后，查看缓存 Restoring cache 步骤的输出信息是什么")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRestoring cache\nChecking cache "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" project-citest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有提供网址，缓存将不会从共享缓存服务器下载。相反，将提取缓存的本地版本。")]),s._v("\nNo URL provided, cache will not be downloaded from shared cache server. Instead a "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" version of cache will be extracted. \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 成功提取缓存")]),s._v("\nSuccessfully extracted cache\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nSaving cache "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" successful job\n00:02\nCreating cache project-citest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWARNING: .gradle/wrapper: no matching files        \n.gradle/caches: found "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1086")]),s._v(" matching files and directories \nNo URL provided, cache will be not uploaded to shared cache server. Cache will be stored only locally. \nCreated cache\nCleaning up "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" based variables\n00:01\nJob succeeded\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("可以看到缓存已经生效了，它将缓存保存到了本地（应该是 GitLab Runner 机器上，我们这里实验的 GitLab Runner 是单机版的 docker）")]),s._v(" "),t("p",[s._v("下面在另外一个任务中尝试获取我们打好的 bootJar 包")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 jar 包打成 image")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerBuild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dockerBuild\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("l build/libs/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("如果不使用  image ，则 gitlab 会默认使用 ruby:2.6 这个 image 来执行我们的 script，那么上述结果如下")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ ls -l build/libs/\nls: cannot access 'build/libs/': No such file or directory\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这个肯定是找不到的。在官网文档中就解释了 "),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/caching/#cache-vs-artifacts",target:"_blank",rel:"noopener noreferrer"}},[s._v("缓存与工件"),t("OutboundLink")],1),s._v("，artifacts （工件）用于阶段之间传递阶段的结果")]),s._v(" "),t("h2",{attrs:{id:"配置-artifacts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-artifacts"}},[s._v("#")]),s._v(" 配置 artifacts")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-bootJar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build/libs/"),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.jar")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expire_in")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1 days\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("控制台输出")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Uploading artifacts "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" successful job\n00:02\nUploading artifacts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nbuild/libs/*.jar: found "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" matching files and directories \nUploading artifacts as "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"archive"')]),s._v(" to coordinator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". ok  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42690")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("responseStatus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("201")]),s._v(" Created "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("token")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("15iuajwR\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("那么在 dockerBuild 流程中的输出关键信息如下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Downloading artifacts\n00:01\nDownloading artifacts "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" build-bootJar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42690")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nDownloading artifacts from coordinator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". ok        "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42690")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("responseStatus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("token")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("15iuajwR\nExecuting "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"step_script"')]),s._v(" stage of the job script\n00:01\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l build/libs/\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16648")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17047394")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 07:20 citest-0.0.1-SNAPSHOT.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"使用-docker-打成-image"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-打成-image"}},[s._v("#")]),s._v(" 使用 docker 打成 image")]),s._v(" "),t("p",[s._v("实现思路")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("使用有 docker 功能的 image")])]),s._v(" "),t("li",[t("p",[s._v("使用命令登录到私有  docker：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"密码"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker login -u "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名"')]),s._v(" --password-stdin "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"私有 docker 仓地址 "')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("完成 docker build 和 push 操作")])])]),s._v(" "),t("p",[s._v("在此之前，需要准备一个 Dockerfile 文件，从上面的测试学习中可知，我们操作的目录是在项目目录下，这个从控制台的日志输出中能看到")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nGetting "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" from Git repository\n00:01\nFetching changes with "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" depth "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新调整这个仓库")]),s._v("\nReinitialized existing Git repository "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /builds/data/project-citest/.git/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# checkout")]),s._v("\nChecking out 6de1661f as main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("那么我们的思路就是，在我们的项目中编写一份 Dockerfile 文件，然后在这个作业中，执行这个文件打包镜像")]),s._v(" "),t("p",[s._v("具体代码如下")]),s._v(" "),t("p",[s._v("Dockerfile")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("FROM xxx/openjdk:8u212-jre-slim\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义工作目录")]),s._v("\nWORKDIR /app\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制 build/libs/*.jar 并重命名为 app.jar")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里写的 *.jar 事实上，我们知道只会产生一个 jar 包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的路径，是作业中下载的工件路径")]),s._v("\nCOPY build/libs/*.jar app.jar\n\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\nENTRYPOINT  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.jar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("作业定义如下")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 将 jar 包打成 image")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 实现思路")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  1. 使用有 docker 功能的 image")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  2. 使用命令登录到私有 docker： echo "密码" | docker login -u "用户名" --password-stdin "私有 docker 仓地址 "')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  3. 完成 docker 操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerBuild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xxx/docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("stable\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dockerBuild\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("l build/libs/\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里使用了自定义的环境变量")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个变量配置入口在项目的 -/settings/ci_cd，设置 -> CI/CD 页面中的 变量 中")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分为项目独有变量 和 群组变量（该群组下的项目可以直接使用）")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "$xx_BUILD_REGISTRY_PASSWORD" '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" docker login "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('u "$xx_BUILD_REGISTRY_USER" '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('stdin "$xx_BUILD_REGISTRY"\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' image_version="1.0"\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' image_name="$'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("xx_BUILD_REGISTRY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/project"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('test/citest"\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" echo $image_name\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -f 指定 Dockerfile 路径")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一条语句写不下，还可以换行写，注意下这个语法")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f ./Dockerfile\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('tag "$image_name'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('$image_version"\n      .\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' docker push "$image_name'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('$image_version"\n  '),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### needs 用于无序执行作业，可以将作业之间的关系可视化为有向无环图")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方文档：https://docs.gitlab.com/ee/ci/yaml/README.html#needs")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# needs:[] 定义，但是不定义依赖的作业，表示 立即执行，需要注意的是它忽略了 stages 定义的执行顺序，类似于可以和其他作业并行执行，这里是立即执行")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# needs:[xxx] 必须要等待 xxx 作业完成，才能执行该作业")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bootJar\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#依赖 build-bootJar，并且需要下载它产生的工件，也就是之前打出来的 xx.jar")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### rules 用于在管道中包括或排除作业，简单说就是符合条件的才会执行该作业")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方文档：https://docs.gitlab.com/ee/ci/yaml/README.html#rules")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 它可以写多个规则（条件），规则将按顺序进行评估，直到第一个匹配为止")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里判定触发 CI 的分支是 main 才执行该作业")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$CI_COMMIT_REF_NAME  == 'main'\"")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" on_success\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("p",[s._v("已经完成了目标，另外，在这基础上应该已经明白了核心的流程配置，后续可以个性化自己的配置。")]),s._v(" "),t("h2",{attrs:{id:"一些关键文档配置路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一些关键文档配置路径"}},[s._v("#")]),s._v(" 一些关键文档配置路径")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/variables/README.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("变量"),t("OutboundLink")],1),s._v(" ：和 linux 中的变量一致，可以直接引用，如 $CI_JOB_STAGE")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("所有预定义的变量"),t("OutboundLink")],1),s._v(" 官方支持的变量，可以直接使用，而不用定义的变量")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#anchors",target:"_blank",rel:"noopener noreferrer"}},[s._v("锚点"),t("OutboundLink")],1),s._v(" yml 语法，可以用来定义一些公共配置的模板，在使用的地方引用即可")]),s._v(" "),t("li",[s._v("CI/DI 替代锚点的语法 "),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#stage",target:"_blank",rel:"noopener noreferrer"}},[s._v("extends"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#stage",target:"_blank",rel:"noopener noreferrer"}},[s._v("阶段 / stages"),t("OutboundLink")],1),s._v("：定义作业执行顺序")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#needs",target:"_blank",rel:"noopener noreferrer"}},[s._v("needs"),t("OutboundLink")],1),s._v("：用于无序执行作业，可以定义依赖某个作业完成后才执行")]),s._v(" "),t("li",[s._v("缓存 / cache ："),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#cache",target:"_blank",rel:"noopener noreferrer"}},[s._v("缓存依赖原理和最佳实践"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#cache",target:"_blank",rel:"noopener noreferrer"}},[s._v("缓存语法"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/caching/#cache-vs-artifacts",target:"_blank",rel:"noopener noreferrer"}},[s._v("缓存与工件/artifacts "),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("规则 / rules"),t("OutboundLink")],1),s._v("：用于条件判定，在哪些条件下可以执行该作业")]),s._v(" "),t("li",[s._v("其他的还是需要通读 "),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#job-keywords",target:"_blank",rel:"noopener noreferrer"}},[s._v(".gitlab-ci.yml 参考文档"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"生产级配置写法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生产级配置写法"}},[s._v("#")]),s._v(" 生产级配置写法")]),s._v(" "),t("h2",{attrs:{id:"一些个性化作业"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一些个性化作业"}},[s._v("#")]),s._v(" 一些个性化作业")]),s._v(" "),t("h2",{attrs:{id:"版本号生成-semantic-release"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本号生成-semantic-release"}},[s._v("#")]),s._v(" 版本号生成 semantic-release")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/semantic-release/semantic-release",target:"_blank",rel:"noopener noreferrer"}},[s._v("semantic-release"),t("OutboundLink")],1),s._v("：可以用该工具生成版本号，有 docker 封装好的镜像，在该镜像上直接使用")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" version\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xxx/semantic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("17.1.1\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在这些分支上才执行 semantic-release 命令")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $CI_COMMIT_REF_NAME == 'alpha' "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o $CI_COMMIT_REF_NAME  == 'master' "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(";\n      then\n      semantic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release;\n      fi\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f ./.version "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(';\n      then\n      echo "VERSION=$'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("xxx_BUILD_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$(date +%Y%m%d%H%M%S)"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".version;\n      fi\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cat .version\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .version\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expire_in")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1 days\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("感觉这里写的版本号生成，并没有使用上 semantic-release 真正的功能，仅仅是自己写了一个日期作为版本号")])])}),[],!1,null,null,null);a.default=e.exports}}]);